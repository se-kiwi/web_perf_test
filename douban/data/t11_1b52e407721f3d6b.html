
;
Do(function(){
  function initSubscription(t){0!=t.length&&(t.delegate("input","change",function(){var t=$(this),i=t.parents("li");t.attr("checked")?i.addClass("on"):i.removeClass("on")}),t.submit(function(i){return window._USER_ABNORMAL?void(window.show_abnormal&&window.show_abnormal()):(i.preventDefault(),void(t.hasClass("inprocess")||t.find(".btn-submit-disable").length||(t.addClass("inprocess"),$.post("/j/status/subscription",t.serializeArray(),function(i){t.removeClass("inprocess"),i.r||($(".statuses-setting .setting-tips").show(),setTimeout(function(){self.location.reload()},1e3))}))))}))}Douban.init_status_setting=function(t){if(t.preventDefault(),window._USER_ABNORMAL)return void(window.show_abnormal&&window.show_abnormal());var i=$(this),s=$(".statuses-setting");if(i.hasClass("a_status_setting_active"))return s.find(".bd").hide(),s.trigger("setting:close"),void i.removeClass("a_status_setting_active");var e=s.find(".bd").show();s.trigger("setting:open"),i.addClass("a_status_setting_active"),0===e.find("form").length&&$.ajax({url:"/j/status/subscription",data:{ck:get_cookie("ck")},dataType:"json",success:function(t){t.r||(s.find(".loading").replaceWith(t.s),initSubscription(e.find("form")))}})},Douban.init_setting_close=function(t){t.preventDefault();var i=$(".statuses-setting");i.find(".hd .a_status_setting").trigger("click"),window.scrollTo(i.offset().top)};var recSubForm=$("#popup-rec-sub");if(recSubForm.length){initSubscription(recSubForm);var selectAll=$("#setting-tips-popup");selectAll.bind("change",function(){var t=this.checked;$.each(recSubForm.find("li"),function(){var i=$(this);t?(i.addClass("on"),i.find("input")[0].checked=!0):(i.removeClass("on"),i.find("input")[0].checked=!1)}),t?recSubForm.find(".btn-submit").removeClass("btn-submit-disable"):recSubForm.find(".btn-submit").addClass("btn-submit-disable")}),recSubForm.find(".item input").bind("change",function(){this.checked||(selectAll[0].checked=!1),0==recSubForm.find(".item input:checked").length?recSubForm.find(".btn-submit").addClass("btn-submit-disable"):recSubForm.find(".btn-submit").removeClass("btn-submit-disable")}),$(".statuses-setting").bind("setting:open",function(){recSubForm.find(".lnk-close").click()})}
  if (EXPAND_SETTING_FORM) {
     $('.statuses-setting').find('.a_status_setting').trigger('click');
  }
  $('a.notice-btn').click(function() {
      $.get('/accounts/j/misc/agree_privacy_policy', {version: '1.0'}, function(ret) {
        if(ret.r == 0) {
            $('.notice-update-privacy').addClass('hide')
        }else {
            alert(ret.message)
        }
      })
  })
});
;
(function() {
  window.Do=window.Do||function(e){"function"==typeof e&&setTimeout(e,0)},Do.add_js=function(e){var a=document.createElement("script");a.src=e,document.getElementsByTagName("head")[0].appendChild(a)},Do.add_css=function(e,a){var t=document.createElement("link");t.rel="stylesheet",t.href=e,document.getElementsByTagName("head")[0].appendChild(t)},Do.check_js=function e(a,t){var n=a();n?t(n):setTimeout(function(){e(a,t)},33)},Do(function(){function e(a){Do.ISay?Do.ISay.init(a):setTimeout(function(){e(a)},80),$.fn.tagsug||i(tagsug_src)}function a(t){var n=t.target,o=t.type,i=$(n);if("A"==n.tagName){var r=!i.data("action");if(""==n.href.split("http")[0]&&r)return;if(t.preventDefault(),window._USER_ABNORMAL)return void(window.show_abnormal&&window.show_abnormal());if(r)return}return Do.ISay||s.text("正在初始化..."),a=null,"INPUT"==n.tagName||"dragenter"===o?window._USER_ABNORMAL?void(window.show_abnormal&&window.show_abnormal()):void setTimeout(function(){e(n,o)},100):(c.focus(),e(n),void t.stopPropagation())}function t(e){a&&a(e)}function n(e){e=void 0===e?!w.data("opened"):e,w.toggle(e).data("opened",e)}function o(e){if(window._USER_ABNORMAL)return void(window.show_abnormal&&window.show_abnormal());var a=$(e.target),t=(a.attr("href"),a.data("action")),o=a.parents("li"),i=o.hasClass("active");if("commodity"===t)return n(),void e.stopImmediatePropagation();if(n(!1),i&&Do.ISay){switch(t){case"main":c.focus();break;case"share":$("#isay-inp-url").focus()}return void e.stopImmediatePropagation()}t&&!i&&(v.removeClass("active"),o.addClass("active"),v=o)}var i=Do.add_js;i(isay_src);var s=$("#isay-label"),c=$("#isay-cont"),r=$("#db-isay");if(setTimeout(function(){c.val()&&s.hide()},50),$("#isay-upload-inp").one("change",t),c.one("focus dragenter",t),r.one("click",t),location.search){for(var d,l=location.search.substring(1).split("&"),u=0;u<l.length;u++){var f=l[u].split("=");"topic"===f[0]&&(d=decodeURIComponent(f[1]))}if(d){c.val("#"+d+"# ");var m=c[0];m.setSelectionRange?(m.focus(),m.setSelectionRange(m.value.length,m.value.length)):(range=m.createTextRange(),range.collapse(!1),range.select())}}var g=$("#isay-act-field"),p=(g.siblings(".item"),$("#isay-submit"),r.find(".btn-group"),r.find(".isay-links")),v=p.find(".active"),w=p.find(".commodity-link .publish-ways");n(!1),$(document).click(function(e){var a=e.target;w.data("opened")&&(a===w[0]||$.contains(w[0],a)||n(!1))}),p.click(function(e){"A"!==e.target.nodeName&&e.stopImmediatePropagation()}),p.find("a").click(o),g.delegate("a","click",function(e){r.hasClass("share-mode")&&o(e)})});
})();
;
  Do(function(){var a=['<div class="popup-container hide">','<div class="popup-wrap">','<div class="popup-small">','<a class="close"></a>','<p class="popup-info">为确保你的帐户安全，并依《网络安全法》要求，<br/>操作前请先验证手机号。</p>','<div class="popup-btns">',' <a class="btn" href="javascript:;" target="_blank">前往验证</a>',"</div>","</div>","</div>","</div>"].join("");$("body").delegate(".js-verify-account","click",function(e){var t=$(this),i=t;if(window._USER_ABNORMAL)return e.preventDefault(),void(window.show_abnormal&&window.show_abnormal());var o=$(".popup-container"),r=i.attr("data-is-verified"),n=i.attr("data-verify-url");r&&"false"!=r.toLowerCase()?i.attr("href")&&i.attr("href").length&&(location.href=i.attr("href")):(e.preventDefault(),o.size()<1&&($("body").append(a),o=$(".popup-container")),o.find(".btn").attr("href",n),o.removeClass("hide"))}).delegate(".popup-container .close","click",function(){$(".popup-container").addClass("hide")})});
  Do(function() {
    var iSay = $('#db-isay')
    var unverifiedButton = iSay.find('[data-is-verified="False"]')
    function checkVerification(e) {
      if (unverifiedButton.length) {
        e.preventDefault()
        unverifiedButton.trigger('click')
      }
    }
    iSay.find('textarea').bind('focus', checkVerification)
    iSay.delegate('.isay-links a', 'click', checkVerification)
  })
;
  Do(function(){var a=['<div class="popup-container hide">','<div class="popup-wrap">','<div class="popup-small">','<a class="close"></a>','<p class="popup-info">为确保你的帐户安全，并依《网络安全法》要求，<br/>操作前请先验证手机号。</p>','<div class="popup-btns">',' <a class="btn" href="javascript:;" target="_blank">前往验证</a>',"</div>","</div>","</div>","</div>"].join("");$("body").delegate(".js-verify-account","click",function(e){var t=$(this),i=t;if(window._USER_ABNORMAL)return e.preventDefault(),void(window.show_abnormal&&window.show_abnormal());var o=$(".popup-container"),r=i.attr("data-is-verified"),n=i.attr("data-verify-url");r&&"false"!=r.toLowerCase()?i.attr("href")&&i.attr("href").length&&(location.href=i.attr("href")):(e.preventDefault(),o.size()<1&&($("body").append(a),o=$(".popup-container")),o.find(".btn").attr("href",n),o.removeClass("hide"))}).delegate(".popup-container .close","click",function(){$(".popup-container").addClass("hide")})});
  Do(function() {
    $('.stream-items').delegate('.status-item .comment-form input[type="text"]', 'focus', function(e) {
      var input = $(e.target)
      var form = input.closest('form')
      var unverifiedButton = form.find('[data-is-verified="False"]')
      if (unverifiedButton.length) {
        unverifiedButton.trigger('click')
      }
    })
  })
;
        Do(function() {
            var DISMISS_API = '/j/status/block_status_ad'
            $('.js-unfold-erebor-ad').bind('click', function(e) {
                e.stopPropagation()
                $(this).closest('.erebor-ad').toggleClass('is-active')
                $(this).closest('.status-item').css('overflow', 'visible')
            })
            $(document).bind('click', function() {
                $('.js-unfold-erebor-ad').closest('.erebor-ad').removeClass('is-active')
            })
            $('.js-dismiss-erebor-ad').bind('click', function() {
                var isInSingleThread = /\/status\//.test(location.href)
                if (isInSingleThread) {
                    alert('不再对此感兴趣。')
                } else {
                    var status = $(this).closest('.new-status')
                    var ad_info = $(this).closest('.erebor-ad').data('ad')
                    $.post_withck(DISMISS_API, ad_info, function(res) {
                        if (!res.r) {
                            status.slideUp('normal', function() {
                                status.remove()
                            })
                        } else {
                            alert('请求失败，请稍后再试。')
                        }
                    })
                }
            })
        })
    ;
"use strict";!function(){var e=document,r=e.querySelectorAll(".verify_user_avatar");Array.prototype.slice.call(r).forEach(function(r){var t=r.getAttribute("id"),a=e.getElementById(t).innerHTML,c=e.querySelectorAll('.status-wrapper[data-uid="'+t+'"] .usr-pic');Array.prototype.slice.call(c).forEach(function(e){e.innerHTML=a,e.className+=" verify",e.querySelector("a").target=""})})}();
Do.add('dialog', {path: 'https://img3.doubanio.com/f/shire/383a6e43f2108dc69e3ff2681bc4dc6c72a5ffb0/js/ui/dialog.js', type: 'js', requires: ['https://img3.doubanio.com/f/shire/8377b9498330a2e6f056d863987cc7a37eb4d486/css/ui/dialog.css']});
Do.add('tagsug', { path: "https://img3.doubanio.com/f/shire/2f84846bba8a5352b5e9f10d3e724f8a869e1b24/js/lib/tagsug.js" });

Do('https://img3.doubanio.com/f/shire/9c77e9e751bafa33e45781cf4697d16c4678af01/js/statuses.js', function(){
  $(function(){var t=$(".stream-items");window.crt_uid=window.crt_uid||("undefined"==typeof uid?"":uid),t.find(".status-wrapper").each(function(t,a){var e=$(this),i=e.attr("data-sid"),r=new Status($(this),i);r.init()});var a=t.find(".status-real-wrapper:not(.say) .hd, .status-real-wrapper.say");a.click(function(t){t.stopPropagation();var a=$(t.target);if(!a.is("img")&&!a.is("a")){t.preventDefault();var e=$(this).data("status-url");e&&(window.location.href=e)}}),t.find(".btn[data-action-type=expend-all]").click(function(t){t.preventDefault();var a=$(this),e=a.data("status-uid"),i=a.parent().prevAll('.status-wrapper[data-uid="'+e+'"]');i.show(),a.parent().remove()}),t.delegate(".video-overlay","click",function(t){return!!$(this).hasClass("no-expand")||($(this).next(".video-object").show(),void $(t.target).hide().prev().hide())}).delegate(".video-object .back","click",function(t){t.preventDefault(),$(this).parent().hide().prevAll().show()}).delegate(".bd blockquote a, .comments-items a:not(.btn)","click",function(t){var a=$(t.target).parents(".status-item"),e=a.attr("data-sid"),i=a.attr("data-action"),r=a.attr("data-target-type"),n=a.attr("data-object-kind");moreurl(this,{from:"nmbp-"+e,action:i,target_type:r,object_kind:n})})});
});
;
window.addEventListener('load', function () {
    Do.ready(function() {
        if ($('.aside').height() > $('.article').height()) {
            return;
        }
        function fixed(t,e){function n(t){for(var e=0,n=t.length;e<n;e++)if(t[e].node.is(":visible"))return t[e]}var i=/ipod|iphone|ipad|android|blackberry|webos|windows phone/i.test(navigator.userAgent);if(!($.browser.ie&&$.browser.version|!0||i)&&t&&0!=t.length){var r,o,a=$(window),d=[],s=e.gap||10,u=$.map(t,function(t){var t=$(t),e=t.position().top;return{node:t,top:e,bottom:e+t.outerHeight(!0)}}).sort(function(t,e){return t.top-e.top}),c=e.container||t.parent(),h=c.width();return{init:function(){this.bindResizeEvent(),a.trigger("resize"),this.bindScrollEvent(),this.setupChecker()},bindScrollEvent:function(){var t=this;a.bind("scroll",function(){var e;return function(n){e&&clearTimeout(e),e=setTimeout(function(){t.handleScroll.call(t,n)},10)}}())},bindResizeEvent:function(){var t=this;a.bind("resize",function(){var e;return function(n){e&&clearTimeout(e),e=setTimeout(function(){t.handleResize.call(t,n)},20)}}())},setupChecker:function(){var e=this;e.getChecker()(t,function(){e.handleNodesUpdate(),a.trigger("resize")})},getChecker:function(){var t=window.MutationObserver||window.WebKitMutationObserver;if(t)return function(e,n){$.each(e,function(e,i){var r=new t(function(t,e){var i=t[0];"attributes"===i.type&&"style"!==i.attributeName?n():(i.addedNodes.length||i.removedNodes.length)&&n()});r.observe(i,{childList:!0,subtree:!0,attributes:!0})})};var e=document.documentElement,n=!!e.addEventListener&&function(){var t,i,r=!1;return i=e.id,t=function(){e.removeEventListener("DOMAttrModified",t,!1),n=!0,e.id=i},e.addEventListener("DOMAttrModified",t,!1),e.id="nw",r="nw"!==e.id,e.id=i,r}();return n?function(t,e){function n(t){($.contains(t.currentTarget,t.relatedNode)||t.currentTarget===t.relatedNode)&&e()}$.each(t,function(t,e){e.addEventListener("DOMNodeInserted",n,!1),e.addEventListener("DOMNodeRemoved",n,!1)})}:this.checkingTimer()},checkingTimer:function(){var t=this,e=[];return clearInterval(t.timer),t.timer=setInterval(function(){for(var t,n=!1,i=0,r=u.length;i<r;i++)if(t=u[i],t.node.outerHeight(!0)!==t.bottom-t.top){n=!0;break}n&&$.each(e,function(t,e){e()})},1e3),function(t,n){e.push(n)}},handleScroll:function(){var t=this,e=a.scrollTop(),n=r&&r.top-s,i=t.getAllFixedNodeHeight(),o=window.innerHeight;0==d.length||e<n&&t.statFixed?t.turnStatic():e>=n&&!t.statFixed&&i<o?t.turnFixed():i>o&&(t.turnStatic(),t.resetBasketNodes(),t.turnFixed())},turnStatic:function(){var t=this;t.statFixed=!1,t.resetNodes()},turnFixed:function(){var t=this,e=0;for(t.statFixed=!0;nodeData=d[e++];)nodeData.node.css({position:"fixed",width:h,top:s+nodeData.top-r.top})},getAllFixedNodeHeight:function(){if(d.length<=0)return 0;for(var t=0,e=0,n=d.length;e<n;e++){var i=d[e].node;"fixed"===i.css("position")&&(t+=i.outerHeight(!0))}return t},resetNodes:function(){t.each(function(t,e){e=$(e),e.css("position","static")})},resetBasketNodes:function(){o=a.height()-e.extraHeight||0,d=function(){for(var t=[],e=s,n=u.length-1,i=u[n].bottom;n>=0;n--){var r=u[n].node.outerHeight(!0);if(!(i-u[n].top+s<=o&&e+r<o))break;e+=r,t.push(u[n])}return t.reverse()}(),r=n(d)},handleNodesUpdate:function(){var t,e=n(u),i=u.indexOf(e);i=Math.max(i,0);for(var r=i,o=u.length;r<o;r++)t=u[r],r!==i&&(t.top=u[r-1].bottom),t.bottom=t.top+t.node.outerHeight(!0)},handleResize:function(){this.resetBasketNodes(),this.turnStatic(),this.handleScroll()}}}}
        fixed($('.aside > div'), {
            extraHeight: 80
        }).init();
    });
})
Do('https://img3.doubanio.com/f/shire/5fde5d6b7ef18adf4fb947449fff1709c73cbceb/js/lib/hotkeys.js', function(){
    $(function(){var h=-1,a=0,f=$("#statuses"),i=$(document),b=$(window),j,l=f.find(".status-item"),e=function(m){f.find(".status-current").removeClass("status-current");l.eq(m).addClass("status-current")},k=function(){var o=$(".thispage").next(),m=o.text()|o;if(m){self.location.href=self.location.pathname+"?p="+m}},g=function(){var o=$(".thispage").prev(),m=o.text()|o;if(m){self.location.href=self.location.pathname+"?p="+m}},d=function(){if(j){window.clearTimeout(j)}var n,m;if(h+1>=l.length){k();return}h++;m=l.eq(h);n=m.offset().top;if(m.css("display")==="none"){d();return}e(h);window.scrollTo(0,n-20)},c=function(){if(j){window.clearTimeout(j)}var m=l.eq((h-1<0)?0:h-1),n=m.offset().top;if(h-1<0){h=0;g();return}h--;if(m.css("display")==="none"){c();return}e(h);window.scrollTo(0,n-20)};if(l.length){b.bind("scroll",function(m){if(j){window.clearTimeout(j)}j=window.setTimeout(function(){var p=i.scrollTop(),o,n;if(p<l.eq(0).offset().top-20){h=0;return}for(o=0,n=l.length;o<n;o++){if(l.eq(o).pos().y>p){h=o;break}}},100)})}$.hotKeys([{keys:[191],handler:function(){var m=$("input[name=search_text]");if(m.length){m.focus();setTimeout(function(){m.val("")},10)}}},{keys:["j"],handler:d},{keys:[73],handler:function(){var m,n=f.find(".status-current");if(n.length===0){return}m=n.find(".comment-text");if(m.length>0){setTimeout(function(){m[0].focus()},20)}}},{keys:[65],handler:function(){var m,n=f.find(".status-current");if(n.length===0){return}m=n.find(".btn-key-like");if(m.length>0){m.click()}}},{keys:[84],handler:function(){var m,n=f.find(".status-current");if(n.length===0){return}m=n.find(".btn-key-reshare");if(m.length>0){m.click()}}},{keys:[71,71],handler:function(){window.scrollTo(0,0)}},{keys:[82],handler:function(o){var m,n=f.find(".status-current");if(n.length===0){return}m=n.find(".btn-action-reply");if(m.length){m.eq(0).click()}}},{keys:[78],handler:function(m){window.scrollTo(0,0);setTimeout(function(){if(Do._init_isay){Do._init_isay()}else{$("#isay-cont").focus()}},10)}},{keys:[71],shift:true,handler:function(){window.scrollTo(0,$("body").innerHeight())}},{keys:["k"],handler:c},{keys:["}"],shift:1,handler:k},{keys:["{"],shift:1,handler:g},{keys:[80,49],handler:function(){self.location.href=self.location.pathname}}])});
});
