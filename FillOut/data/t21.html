

<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">

<html xmlns="http://www.w3.org/1999/xhtml">
<head><title>

</title>
    <style>
        body
        {
            margin:0;
        }
        .file input{
                position: absolute;left: 0;top: 0;height: 44px; filter:alpha(opacity=0);opacity:0; background-color: #fff;width:100%; font-size:18px;
        }
        .file{
          height: 44px; background:#fff; text-align: left; line-height: 44px; overflow: hidden;position: relative;border:1px dashed #CCCCCC;color:#808080;font-size:15px;_border:none;cursor:pointer
        }
        /*.uppic{
            width:18px;height:18px;margin:-4px 8px 0 22px;vertical-align:middle;*vertical-align:auto;
        }*/
        .uppic{
            display: inline-block;
            width:18px;
            height:18px;
            margin:-4px 8px 0 22px;
            vertical-align:middle;
            *vertical-align:auto;
            background-size: 18px 18px;
            background-position: center;
            background-image: url(/Images/newimg/newupload/upload-pc@2x.png);
            filter: progid:DXImageTransform.Microsoft.AlphaImageLoader(src='/Images/newimg/newupload/upload-pc@2x.png',sizingMethod='scale');
        }
        .file:hover .uppic {
            background-image: url(/Images/newimg/newupload/upload-pc-pre@2x.png);
            filter: progid:DXImageTransform.Microsoft.AlphaImageLoader(src='/Images/newimg/newupload/upload-pc-pre@2x.png',sizingMethod='scale');
        }
    </style>
</head>
<body>
     <form action="https://wjx-z0.qiniup.com"
	method="post" enctype="multipart/form-data" id="uploadForm">
      <input type="hidden" name="token" value="-kY3jr8KMC7l3KkIN3OcIs8Q4s40OfGgUHr1Rg4D:8G473TZNjs3P0EvDQr4SPwEkiNg=:eyJzY29wZSI6InNvanVtcCIsInJldHVyblVybCI6Imh0dHBzOi8vd3d3LndqeC5jbi93angvam9pbi91cGxvYWRxaW5pdS5hc3B4P2FjdGl2aXR5PTE0NTE0Njg5JnE9MyZtcz00MDk2IiwicmV0dXJuQm9keSI6IntcInNpemVcIjpcIiQoZnNpemUpXCIsXCJuYW1lXCI6XCIkKGZuYW1lKVwiLFwia2V5XCI6XCIkKGtleSlcIixcIm1pbWVUeXBlXCI6XCIkKG1pbWVUeXBlKVwifSIsImRlYWRsaW5lIjoxNzE3ODA1NDAyLCJzYXZlS2V5IjoiMTQ1MTQ2ODlfNjBfcTNfUzBjWExVeXRFU3BZN1BWaGFsWkFnJChleHQpIiwiaW5zZXJ0T25seSI6MSwiZGV0ZWN0TWltZSI6MCwibWltZUxpbWl0IjoiaW1hZ2UvanBnO2ltYWdlL2pwZWc7aW1hZ2UvZ2lmO2ltYWdlL2JtcDtpbWFnZS9wbmc7YXBwbGljYXRpb24vcGRmO2FwcGxpY2F0aW9uL21zd29yZDthcHBsaWNhdGlvbi92bmQub3BlbnhtbGZvcm1hdHMtb2ZmaWNlZG9jdW1lbnQud29yZHByb2Nlc3NpbmdtbC5kb2N1bWVudDthcHBsaWNhdGlvbi92bmQubXMtZXhjZWw7YXBwbGljYXRpb24vdm5kLm9wZW54bWxmb3JtYXRzLW9mZmljZWRvY3VtZW50LnNwcmVhZHNoZWV0bWwuc2hlZXQ7YXBwbGljYXRpb24vdm5kLm1zLXBvd2VycG9pbnQ7YXBwbGljYXRpb24vdm5kLm9wZW54bWxmb3JtYXRzLW9mZmljZWRvY3VtZW50LnByZXNlbnRhdGlvbm1sLnByZXNlbnRhdGlvbjt0ZXh0L3BsYWluO2FwcGxpY2F0aW9uL3gtcmFyLWNvbXByZXNzZWQ7YXBwbGljYXRpb24veC1yYXI7YXBwbGljYXRpb24vemlwO2FwcGxpY2F0aW9uL3gtZ3ppcDt2aWRlby9tcDQ7YXBwbGljYXRpb24veC1tcGVnVVJMO3ZpZGVvL3gtZmx2O3ZpZGVvL3gtZjR2O3ZpZGVvL3dlYm07dmlkZW8vcXVpY2t0aW1lO3ZpZGVvL3gtbTR2O3ZpZGVvLzNncHA7dmlkZW8veC1tc3ZpZGVvO3ZpZGVvL3gtbXMtd212O2F1ZGlvL21wZWc7YXVkaW8veC1tcy13bWE7YXVkaW8veC13YXY7YXVkaW8vQU1SO3RleHQveC1jKytzcmM7dGV4dC94LWNzcmMiLCJmc2l6ZUxpbWl0Ijo0MTk0MzA0fQ==" />
   <div class="file">
       
       <i class="uppic"></i>
       <span id="divVMsg">选择文件( 不超过4M )</span><input type="file"  name="file" id="fileUpload"/></div>
    </form>
    <script type="text/javascript">
        function $(id) {
            return document.getElementById(id) || id;
        }
        var fileUpload = $('fileUpload');
        var uploadFileTimer;
        var hasUsed=0;
        var form = $('uploadForm');
        var maxSize = '4096';
        if(hasUsed){
            var divVMsg=document.getElementById("divVMsg");
            divVMsg.innerHTML="问卷发布者的上传空间已经使用完";
            divVMsg.style.color="red";
            divVMsg.style.fontSize="12px";
        }
        function setUploadDiv() {
            if (window.parent.isUploadingFile) {
                alert('请先等待当前的文件上传完毕，再上传！');
                if (window.parent.curfilediv)
                    window.parent.curfilediv.scrollIntoView();
                return false;
            }
            if (window.curdiv) {
                window.curdiv.onclick();
            }
            window.parent.curfilediv = window.curdiv || window.parent.curdiv;
            return true;
        }
        fileUpload.onclick = setUploadDiv;
        fileUpload.onchange = function () {
            uploadClick();
        }
        Array.prototype.indexOf = function (vItem) {
            for (var i = 0, l = this.length; i < l; i++) {
                if (this[i] == vItem) {
                    return i;
                }
            }
            return -1;
        };
        var iLen = 0; var uploadInterval = null; var totalLen = 30;
        function checkStatus() {
            window.parent.curfilediv.uploadmsg.innerHTML = iLen < totalLen ? window.parent.curfilediv.uploadmsg.innerHTML + ">" : "";
            iLen++;
            if (iLen >= totalLen) {
                iLen = 0;
                window.parent.curfilediv.uploadmsg.innerHTML = "正在上传...";
            }
        }
        var spChars = ["$", "}", "^", "|", "!", "<"];
        var spToChars = ["ξ", "｝", "ˆ", "¦", "！", "&lt;"];
        function replace_specialChar(str) {
            for(var i=0;i<spChars.length;i++){
                var reg = new RegExp("(\\"+spChars[i]+")", "g");
                str = str.replace(reg, spToChars[i]);
            }
            if (/^[A-Za-z\s\.,]+$/.test(str))
                str = str.replace(/\s+/g, ' ');
            str = str.replace(/[^\x09\x0A\x0D\x20-\uD7FF\uE000-\uFFFD\u10000-\u10FFFF]/ig, "");
            return str;
        }
        function uploadClick() {
            iLen = 0;
            if (hasUsed) {
                alert("问卷发布者的上传空间已经使用完，请联系发布者！");
                return false;
            }
            if (!setUploadDiv()) return false;

            
            var vaild = fileUpload.value.length > 0;

            if (vaild) {
                var f_path = fileUpload.value;
                var ext = get_ext(f_path);
                var allowExt = window._ext || ".jpg|.jpeg|.gif|.bmp|.png|.pdf|.doc|.docx|.xls|.xlsx|.ppt|.pptx|.txt|.rar|.zip|.gzip|.mp4|.m3u8|.flv|.f4v|.webm|.mov|.m4v|.3gp|.avi|.wmv|.mp3|.wma|.wav|.amr";
                var arrayExts = allowExt.split("|");
                if (arrayExts.indexOf(ext) == -1) {
                    window.parent.curfilediv.uploadmsg.innerHTML = "文件扩展名只能为" + allowExt; return false;
                }
                if(fileUpload.files){
                    var file=fileUpload.files[0];
                    if(file){
                        if(file.size>parseInt( maxSize)*1024){
                            alert("文件最大只能上传"+ parseInt(maxSize)/1024+"M");
                            return false;
                        }
                    }
                }
                if (window.parent.curfilediv) {
                    window.parent.curfilediv.uploadmsg.innerHTML = "正在上传...";
                    uploadInterval = setInterval(checkStatus, 1000);
                    window.parent.updateProgressBar(window.parent.curfilediv.dataNode);
                }
                window.parent.isUploadingFile = true;

                form.submit();
            }
            else {
                window.parent.curfilediv.uploadmsg.innerHTML = "请先选择文件，再上传！";
                return false;
            }
        }
        var extd='';
        function setAccept() {
            var allowExt = extd || ".jpg|.jpeg|.gif|.bmp|.png|.pdf|.doc|.docx|.xls|.xlsx|.ppt|.pptx|.txt|.rar|.zip|.gzip|.mp4|.m3u8|.flv|.f4v|.webm|.mov|.m4v|.3gp|.avi|.wmv|.mp3|.wma|.wav|.amr";
            var mime = GetMime(allowExt);
            fileUpload.accept = mime;
        }
        setAccept();
        function GetMime(fileext) {
            var exts = fileext.split('|');
            var mime = "";  
            for (var i=0;i<exts.length;i++) {
                var e=exts[i];
                if (i > 0) mime += ",";
                if (e == ".txt") mime += "text/plain";
                else if (e == ".jpg" || e == ".png" || e == ".jpeg" || e == ".bmp" || e == ".gif")
                    mime += "image/" + e.replace(".", "");
                else if (e == ".doc")
                    mime += "application/msword";
                else if (e == ".docx")
                    mime += "application/vnd.openxmlformats-officedocument.wordprocessingml.document";
                else if (e == ".xls")
                    mime += "application/vnd.ms-excel";
                else if (e == ".xlsx")
                    mime += "application/vnd.openxmlformats-officedocument.spreadsheetml.sheet";
                else if (e == ".ppt")
                    mime += "application/vnd.ms-powerpoint";
                else if (e == ".pptx")
                    mime += "application/vnd.openxmlformats-officedocument.presentationml.presentation";
                else if (e == ".pdf")
                    mime += "application/pdf";
                else if (e == ".zip")
                    mime += "application/zip";
                else if (e == ".gzip")
                    mime += "application/x-gzip";
                else if (e == ".rar")
                    mime += "application/x-rar-compressed;application/x-rar";
                else if (e == ".mp4")
                    mime += "video/mp4";
                else if (e == ".webm")
                    mime += "video/webm";
                else if (e == ".mov")
                    mime += "video/quicktime";
                else if (e == ".m4v")
                    mime += "video/x-m4v";
                else if (e == ".3gp")
                    mime += "video/3gpp";
                else if (e == ".avi")
                    mime += "video/x-msvideo";
                else if (e == ".wmv")
                    mime += "video/x-ms-wmv";
                else if (e == ".f4v")
                    mime += "video/x-f4v";
                else if (e == ".flv")
                    mime += "video/x-flv";
                else if (e == ".m3u8")
                    mime += "application/x-mpegURL";
                else if (e == ".wav")
                    mime += "audio/x-wav";
                else if (e == ".mp3")
                    mime += "audio/mpeg";
                else if (e == ".wma")
                    mime += "audio/x-ms-wma";
                else if (e == ".amr")
                    mime += "audio/amr";
                else
                    mime += "application/" + e.replace(".", "");
            }
            return mime;
        }
       
        //获取文件扩展名
        function get_ext(f_path) {
            var ext = '';
            if (f_path != null && f_path.length > 0) {
                f_path = f_path;
                ext = f_path.substring(f_path.lastIndexOf("."), f_path.length);
            }
            return ext.toLowerCase();
        }
        var fileName = "14514689_60_q3_GrgMzPqoFUKfwrUdLgRPg.jpg,23452,timg.jpg";
        var errorCode = "";
        var errorMsg = "";
        var filePath="http://pubuserqiniu.paperol.cn/14514689_60_q3_GrgMzPqoFUKfwrUdLgRPg.jpg?imageMogr2/thumbnail/120x120&e=1560125462&token=-kY3jr8KMC7l3KkIN3OcIs8Q4s40OfGgUHr1Rg4D:6SHKsJijTkfZwvVrqr24FcEH_Zk=";
        
        function uploadF() {
            if(fileName){
                fileName=replace_specialChar(fileName);
                window.parent.curfilediv.uploadFinish('文件已经成功上传！', encodeURIComponent(fileName),filePath);
            }
            else
                window.parent.curfilediv.uploadFinish(errorMsg, '');
        }
        if (fileName || errorMsg) {
            uploadF();
        }
        
    </script>
    
</body>
</html>
